name: Daily News Push

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ10:30è¿è¡Œï¼ˆUTCæ—¶é—´2:30ï¼‰
    - cron: '30 2 * * *'
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  send-news:
    runs-on: ubuntu-latest
    
    steps:
    - name: å‘é€æ¯æ—¥æ–°é—»åˆ°ä¼ä¸šå¾®ä¿¡
      env:
        WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
      run: |
        # è·å–æ–°é—»å†…å®¹
        NEWS=$(curl -s "https://60s.viki.moe/v2/60s?encoding=text")
        
        # è·å–å½“å‰æ—¥æœŸ
        DATE=$(date +"%Yå¹´%mæœˆ%dæ—¥")
        
        # æ„å»ºå‘é€æ¶ˆæ¯çš„æ ¼å¼
        JSON_DATA=$(cat <<EOF
        {
          "msgtype": "markdown",
          "markdown": {
            "content": "## ğŸŒ æ¯æ—¥60ç§’æ–°é—»å¿«æŠ¥ ($DATE)\n\n$NEWS\n\n---\nğŸ“… æ›´æ–°æ—¶é—´ï¼š$(date +"%H:%M")\nğŸ”— æ•°æ®æºï¼š60s API"
          }
        }
        EOF
        )
        
        # å‘é€åˆ°ä¼ä¸šå¾®ä¿¡
        curl -X POST \
          -H "Content-Type: application/json" \
          -d "$JSON_DATA" \
          "$WEBHOOK_URL"
        
        echo "âœ… æ–°é—»å·²å‘é€åˆ°ä¼ä¸šå¾®ä¿¡"
